# KonataAPI - æ­¤æ–¹APIæŸ¥æŸ¥

ä¸€ä¸ªç”¨äºæŸ¥è¯¢ AI ä¸­è½¬ç«™ä½™é¢å’Œè°ƒç”¨æ—¥å¿—çš„æ¡Œé¢å·¥å…·ã€‚

## åŠŸèƒ½ç‰¹æ€§

- æ”¯æŒå¤šä¸­è½¬ç«™é…ç½®ç®¡ç†
![alt text](assets/ç«™ç‚¹ç»Ÿè®¡.png)
- æŸ¥è¯¢è´¦æˆ·ä½™é¢ï¼ˆUSD / Token ä¸¤ç§ç»Ÿè®¡æ–¹å¼ï¼‰
![alt text](assets/ä½™é¢æŸ¥è¯¢.png)
- æŸ¥è¯¢è°ƒç”¨æ—¥å¿—
![alt text](assets/æ—¥å¿—æŸ¥è¯¢.png)
- æ‰¹é‡æŸ¥è¯¢æ‰€æœ‰é…ç½®çš„ä½™é¢
- è‡ªå®šä¹‰ API æ¥å£è·¯å¾„
- **å¤šç§è®¤è¯æ–¹å¼** - æ”¯æŒ Bearer Token å’Œ URL Key ä¸¤ç§è®¤è¯
- **å¤šç§ API æ ¼å¼** - è‡ªåŠ¨æ£€æµ‹ OpenAIã€NewAPIã€sub2api ç­‰å¤šç§æ ¼å¼
- æŒ‰ç«™ç‚¹é…ç½®æ—¥å¿—ä»£ç†ï¼ˆè§£å†³éƒ¨åˆ†ç«™ç‚¹é™åˆ¶ï¼‰
- æŸ¥çœ‹åŸå§‹ API è¿”å›æ•°æ®
- **ç³»ç»Ÿæ‰˜ç›˜æ”¯æŒ** - æœ€å°åŒ–åˆ°æ‰˜ç›˜ï¼Œå³é”®èœå•å¿«æ·æ“ä½œ
- **å¼€æœºè‡ªå¯åŠ¨** - å¯é€‰éš Windows å¯åŠ¨è‡ªåŠ¨è¿è¡Œ
- **è‡ªåŠ¨æ‰¹é‡æŸ¥è¯¢** - å®šæ—¶è‡ªåŠ¨æŸ¥è¯¢æ‰€æœ‰ç«™ç‚¹ä½™é¢
- **ç«™ç‚¹ç»Ÿè®¡æ¨¡å—** - ç®¡ç†ç«™ç‚¹æ¡£æ¡ˆã€æ‰‹åŠ¨è®°å½•ä½™é¢ã€è®°å½•å……å€¼ã€ç»Ÿè®¡æ¶ˆè´¹
- **ç«™ç‚¹æµ‹è¯•æ¨¡å—** - è¿é€šæ€§æµ‹è¯•ã€Claude çœŸä¼ªæ€§æ£€æµ‹ã€åŸç”Ÿå¯¹è¯
  - **å¤šç§ API é¢„è®¾** - æ”¯æŒåŸç”Ÿ Anthropic/OpenAIã€ä¸­è½¬ç«™æ ¼å¼ã€Claude CLI çœŸå®æ ¼å¼
  - **Claude CLI çœŸå®æ ¼å¼** - å®Œå…¨æ¨¡æ‹Ÿ Claude Code CLI è¯·æ±‚ï¼Œå¯ç»•è¿‡éƒ¨åˆ†ä¸­è½¬ç«™éªŒè¯
- **ä¸€é”®ç­¾åˆ°åŠŸèƒ½** - é…ç½®ç­¾åˆ°ç½‘å€ï¼Œæ‰¹é‡æ‰“å¼€æ‰€æœ‰ç­¾åˆ°é¡µé¢
![alt text](assets/è¿é€šæ€§æµ‹è¯•.png)
![alt text](assets/çœŸä¼ªæ€§æµ‹è¯•.png)


## ç•Œé¢å¸ƒå±€

ä¸»ç•Œé¢é‡‡ç”¨**æ ‡ç­¾é¡µåˆ‡æ¢**è®¾è®¡ï¼Œå·¦ä¾§ä¸ºå…¨å±€ç«™ç‚¹åˆ—è¡¨ï¼Œå³ä¾§åˆ†ä¸ºä¸‰ä¸ªåŠŸèƒ½æ ‡ç­¾é¡µï¼š

| æ ‡ç­¾é¡µ | åŠŸèƒ½ | è¯´æ˜ |
|--------|------|------|
| **ğŸ“Š æ•°æ®ç»Ÿè®¡** | ç«™ç‚¹æ¡£æ¡ˆç®¡ç† | ç®¡ç†ç«™ç‚¹ä¿¡æ¯ã€è®°å½•å……å€¼ã€é…ç½®ç­¾åˆ°ç½‘å€ã€æŸ¥çœ‹ç»Ÿè®¡å›¾è¡¨ |
| **ğŸ’° ä½™é¢æŸ¥è¯¢** | æŸ¥è¯¢ä½™é¢/æ—¥å¿— | æŸ¥è¯¢ä½™é¢å’Œè°ƒç”¨æ—¥å¿—ï¼Œæ”¯æŒé«˜çº§æ¥å£è®¾ç½® |
| **ğŸ§ª ç«™ç‚¹æµ‹è¯•** | è¿é€šæ€§/çœŸä¼ªæ€§æµ‹è¯• | æµ‹è¯•ç«™ç‚¹è¿é€šæ€§ã€æ£€æµ‹æ¨¡å‹çœŸä¼ªã€åŸç”Ÿå¯¹è¯ |

**ä½¿ç”¨æµç¨‹ï¼š**
1. åœ¨å·¦ä¾§ã€Œä¸­è½¬ç«™åˆ—è¡¨ã€ç‚¹å‡»é€‰æ‹©ç«™ç‚¹ï¼ˆæˆ–ç‚¹å‡»ã€Œâ• æ·»åŠ ç«™ç‚¹ã€æ–°å»ºï¼‰
2. ç«™ç‚¹ä¿¡æ¯è‡ªåŠ¨åŒæ­¥åˆ°æ‰€æœ‰æ ‡ç­¾é¡µ
3. åœ¨ã€ŒğŸ“Š æ•°æ®ç»Ÿè®¡ã€ä¸­ç¼–è¾‘ç«™ç‚¹è¯¦ç»†ä¿¡æ¯
4. åˆ‡æ¢æ ‡ç­¾é¡µæ‰§è¡Œä½™é¢æŸ¥è¯¢æˆ–ç«™ç‚¹æµ‹è¯•

**å·¦ä¾§åˆ—è¡¨æ“ä½œæŒ‰é’®ï¼š**
- **â• æ·»åŠ ç«™ç‚¹** - æ–°å»ºç«™ç‚¹ï¼Œè‡ªåŠ¨è·³è½¬åˆ°æ•°æ®ç»Ÿè®¡ç¼–è¾‘
- **ğŸ”„ æŸ¥è¯¢å…¨éƒ¨ä½™é¢** - æ‰¹é‡æŸ¥è¯¢æ‰€æœ‰ç«™ç‚¹ä½™é¢
- **ğŸ ä¸€é”®ç­¾åˆ°** - æ‰“å¼€æ‰€æœ‰é…ç½®äº†ç­¾åˆ°ç½‘å€çš„ç«™ç‚¹
- **ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­** - åˆ é™¤å½“å‰é€‰ä¸­çš„ç«™ç‚¹


## æ•°æ®æ¶æ„

KonataAPI ä½¿ç”¨ä¸¤ä¸ªé…ç½®æ–‡ä»¶åˆ†åˆ«ç®¡ç†ä¸åŒç±»å‹çš„æ•°æ®ï¼š

| æ–‡ä»¶ | ç”¨é€” | è¯´æ˜ |
|------|------|------|
| **stats.json** | ç«™ç‚¹æ•°æ® | ç«™ç‚¹åˆ—è¡¨ä¸»æ•°æ®æºï¼ŒåŒ…å«åç§°ã€URLã€API Keyã€ç­¾åˆ°ç½‘å€ã€ç»Ÿè®¡æ•°æ®ç­‰ |
| **config.json** | å…¨å±€è®¾ç½® | API ç«¯ç‚¹é…ç½®ã€æ‰˜ç›˜è®¾ç½®ã€è‡ªåŠ¨æŸ¥è¯¢è®¾ç½®ç­‰åº”ç”¨çº§é…ç½® |

> **æ³¨æ„**ï¼šç«™ç‚¹ç®¡ç†ç»Ÿä¸€åœ¨ã€ŒğŸ“Š æ•°æ®ç»Ÿè®¡ã€æ¨¡å—ä¸­è¿›è¡Œï¼Œå·¦ä¾§åˆ—è¡¨å±•ç¤ºçš„æ˜¯ stats.json ä¸­çš„ç«™ç‚¹ã€‚


## æ”¯æŒçš„ API æ ¼å¼

KonataAPI æ”¯æŒè‡ªåŠ¨æ£€æµ‹å¤šç§ä¸­è½¬ç«™ API æ ¼å¼ï¼š

| æ ¼å¼ | ä½™é¢æ¥å£ | æ—¥å¿—æ¥å£ | è®¤è¯æ–¹å¼ | è¯´æ˜ |
|------|---------|---------|---------|------|
| **OpenAI å…¼å®¹** | `/v1/dashboard/billing/subscription` | - | Bearer sk-xxx | å¤§éƒ¨åˆ†ä¸­è½¬ç«™é»˜è®¤æ ¼å¼ |
| **NewAPI / One-API** | `/api/usage/token/` | `/api/log/token` | Bearer sk-xxx | å›½å†…å¸¸è§ä¸­è½¬ç«™ |
| **sub2api** | `/v1/usage` | âŒ ä¸æ”¯æŒ | Bearer sk-xxx | Claude è®¢é˜…è½¬ API |

### è‡ªåŠ¨æ£€æµ‹é¡ºåº

ç¨‹åºä¼šæŒ‰ä»¥ä¸‹é¡ºåºè‡ªåŠ¨å°è¯•ä¸åŒçš„ API æ ¼å¼ï¼š

1. **OpenAI å…¼å®¹æ ¼å¼** - `/v1/dashboard/billing/subscription`
2. **sub2api æ ¼å¼** - `/v1/usage`ï¼ˆè¿”å›ä½™é¢+ç”¨é‡ç»Ÿè®¡ï¼‰
3. **JWT Token æ ¼å¼** - `/api/v1/auth/me`ï¼ˆéœ€è¦ç™»å½•æ€ï¼‰
4. **NewAPI Token æ ¼å¼** - `/api/usage/token/`

å¤§å¤šæ•°æƒ…å†µä¸‹æ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œç¨‹åºä¼šè‡ªåŠ¨è¯†åˆ«ç«™ç‚¹ç±»å‹ã€‚

### sub2api ç«™ç‚¹è¯´æ˜

åŸºäº [sub2api](https://github.com/Wei-Shaw/sub2api) çš„ç«™ç‚¹ï¼ˆå¦‚ Forwardï¼‰ï¼š
- âœ… **ä½™é¢æŸ¥è¯¢**ï¼šæ”¯æŒï¼Œé€šè¿‡ `/v1/usage` æ¥å£
- âŒ **æ—¥å¿—æŸ¥è¯¢**ï¼šä¸æ”¯æŒï¼Œsub2api çš„æ—¥å¿—æ¥å£éœ€è¦ JWT Tokenï¼ˆç™»å½•æ€ï¼‰

## å®‰è£…

### ä¾èµ–

- Python 3.8+
- Windowsï¼ˆGUI åŸºäº tkinterï¼‰

### å®‰è£…æ­¥éª¤

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-username/KonataAPI.git
cd KonataAPI

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

## ä½¿ç”¨æ–¹æ³•

### è¿è¡Œç¨‹åº

```bash
python main.py
```

### æ·»åŠ ç«™ç‚¹

1. ç‚¹å‡»å·¦ä¾§ã€Œâ• æ·»åŠ ç«™ç‚¹ã€æŒ‰é’®
2. è‡ªåŠ¨è·³è½¬åˆ°ã€ŒğŸ“Š æ•°æ®ç»Ÿè®¡ã€æ ‡ç­¾é¡µ
3. å¡«å†™ç«™ç‚¹åç§°ã€Base URLã€API Key ç­‰ä¿¡æ¯
4. ç‚¹å‡»ã€ŒğŸ’¾ ä¿å­˜ä¿®æ”¹ã€

### ä¸€é”®ç­¾åˆ°

1. åœ¨ã€ŒğŸ“Š æ•°æ®ç»Ÿè®¡ã€æ ‡ç­¾é¡µé€‰æ‹©ç«™ç‚¹
2. å¡«å†™ã€Œç­¾åˆ°ç½‘å€ã€ï¼ˆå¦‚ `https://xxx.com/user/checkin`ï¼‰
3. ç‚¹å‡»ã€Œä¿å­˜ä¿®æ”¹ã€
4. ç‚¹å‡»å·¦ä¾§ã€ŒğŸ ä¸€é”®ç­¾åˆ°ã€æ‰¹é‡æ‰“å¼€æ‰€æœ‰é…ç½®äº†ç­¾åˆ°ç½‘å€çš„ç«™ç‚¹

### é«˜çº§æ¥å£è®¾ç½®

æ¯ä¸ªç«™ç‚¹å¯ä»¥ç‹¬ç«‹é…ç½® API æ¥å£è·¯å¾„å’Œè®¤è¯æ–¹å¼ï¼š

1. é€‰æ‹©ç«™ç‚¹åï¼Œåœ¨ã€ŒğŸ’° ä½™é¢æŸ¥è¯¢ã€æ ‡ç­¾é¡µç‚¹å‡»ã€Œâš™ï¸ é«˜çº§è®¾ç½®ã€
2. å¯é…ç½®çš„é€‰é¡¹ï¼š
   - **ä½™é¢æŸ¥è¯¢è®¤è¯æ–¹å¼** - Bearer Token æˆ– URL Key
   - **æ—¥å¿—æŸ¥è¯¢è®¤è¯æ–¹å¼** - Bearer Token æˆ– URL Key
   - **æ—¥å¿—ä»£ç†åœ°å€** - éƒ¨åˆ†ç«™ç‚¹éœ€è¦ä»£ç†è®¿é—®
   - **è‡ªå®šä¹‰æ¥å£è·¯å¾„** - è¦†ç›–å…¨å±€é»˜è®¤çš„ API è·¯å¾„
3. ç‚¹å‡»ã€Œä¿å­˜ã€ï¼Œè®¾ç½®å°†ä¿å­˜åˆ°ç«™ç‚¹æ•°æ®ä¸­

### æ—¥å¿—ä»£ç†ï¼ˆå¯é€‰ï¼‰

éƒ¨åˆ†ä¸­è½¬ç«™çš„æ—¥å¿—æ¥å£æœ‰è®¿é—®é™åˆ¶ï¼Œéœ€è¦é€šè¿‡ä»£ç†è®¿é—®ã€‚å¯ä»¥åœ¨ã€Œé«˜çº§è®¾ç½®ã€ä¸­ä¸ºå•ä¸ªç«™ç‚¹é…ç½®ä»£ç†åœ°å€ã€‚

### é…ç½®æ–‡ä»¶æ ¼å¼

#### å…¨å±€è®¾ç½® - config.json

å…¨å±€è®¾ç½®æ–‡ä»¶ä½äº `config/config.json`ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```json
{
  "api_endpoints": {
    "balance_subscription": "/v1/dashboard/billing/subscription",
    "balance_usage": "/v1/dashboard/billing/usage",
    "logs": "/api/log/token",
    "logs_page_size": 50
  },
  "minimize_to_tray": true,
  "auto_query": {
    "enabled": false,
    "interval_minutes": 30
  },
  "low_balance_threshold": 10
}
```

å­—æ®µè¯´æ˜ï¼š
- `api_endpoints` - å…¨å±€æ¥å£è·¯å¾„é…ç½®ï¼ˆå¯åœ¨è®¾ç½®ä¸­ä¿®æ”¹ï¼‰
  - `balance_subscription` - ä½™é¢è®¢é˜…æ¥å£è·¯å¾„
  - `balance_usage` - ç”¨é‡ç»Ÿè®¡æ¥å£è·¯å¾„
  - `logs` - æ—¥å¿—æŸ¥è¯¢æ¥å£è·¯å¾„
  - `logs_page_size` - æ—¥å¿—æ¯é¡µæ•°é‡
- `minimize_to_tray` - å…³é—­çª—å£æ—¶æ˜¯å¦æœ€å°åŒ–åˆ°æ‰˜ç›˜
- `auto_query` - è‡ªåŠ¨æŸ¥è¯¢è®¾ç½®
  - `enabled` - æ˜¯å¦å¯ç”¨è‡ªåŠ¨æŸ¥è¯¢
  - `interval_minutes` - æŸ¥è¯¢é—´éš”ï¼ˆåˆ†é’Ÿï¼‰
- `low_balance_threshold` - ä½ä½™é¢è­¦å‘Šé˜ˆå€¼

#### ç«™ç‚¹æ•°æ® - stats.json

ç«™ç‚¹æ•°æ®æ–‡ä»¶ä½äº `config/stats.json`ï¼Œè¿™æ˜¯ç«™ç‚¹åˆ—è¡¨çš„**ä¸»æ•°æ®æº**ï¼š

```json
{
  "sites": [
    {
      "id": "uuid-xxx-xxx",
      "name": "ç«™ç‚¹åç§°",
      "url": "https://api.example.com",
      "api_key": "sk-your-api-key",
      "type": "paid",
      "tags": ["claude", "gpt"],
      "balance": 100.0,
      "balance_unit": "USD",
      "checkin_url": "https://example.com/user/checkin",
      "notes": "å¤‡æ³¨ä¿¡æ¯",
      "balance_auth_type": "bearer",
      "log_auth_type": "url_key",
      "proxy": "",
      "endpoints": {
        "balance_subscription": "/v1/dashboard/billing/subscription",
        "balance_usage": "/v1/dashboard/billing/usage",
        "logs": "/api/log/token"
      },
      "recharge_records": [
        {
          "date": "2024-01-01",
          "amount": 50.0,
          "note": "é¦–æ¬¡å……å€¼"
        }
      ]
    }
  ]
}
```

å­—æ®µè¯´æ˜ï¼š
- `id` - ç«™ç‚¹å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼Œè‡ªåŠ¨ç”Ÿæˆï¼‰
- `name` - ç«™ç‚¹åç§°
- `url` - API åŸºç¡€åœ°å€
- `api_key` - API Key
- `type` - ç«™ç‚¹ç±»å‹ï¼ˆ`paid` ä»˜è´¹ / `free` å…è´¹ï¼‰
- `tags` - æ ‡ç­¾åˆ—è¡¨
- `balance` - å½“å‰ä½™é¢ï¼ˆæ‰‹åŠ¨è®°å½•ï¼‰
- `balance_unit` - ä½™é¢å•ä½
- `checkin_url` - ç­¾åˆ°ç½‘å€ï¼ˆç”¨äºä¸€é”®ç­¾åˆ°ï¼‰
- `notes` - å¤‡æ³¨ä¿¡æ¯
- `balance_auth_type` - ä½™é¢æŸ¥è¯¢è®¤è¯æ–¹å¼ï¼ˆ`bearer` / `url_key`ï¼‰
- `log_auth_type` - æ—¥å¿—æŸ¥è¯¢è®¤è¯æ–¹å¼ï¼ˆ`bearer` / `url_key`ï¼‰
- `proxy` - æ—¥å¿—ä»£ç†åœ°å€ï¼ˆå¯é€‰ï¼‰
- `endpoints` - ç«™ç‚¹çº§åˆ«è‡ªå®šä¹‰æ¥å£è·¯å¾„ï¼ˆå¯é€‰ï¼Œè¦†ç›–å…¨å±€è®¾ç½®ï¼‰
- `recharge_records` - å……å€¼è®°å½•åˆ—è¡¨

## æ‰“åŒ…ä¸ºå¯æ‰§è¡Œæ–‡ä»¶

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ spec æ–‡ä»¶ï¼ˆæ¨èï¼‰

```bash
pip install pyinstaller
pyinstaller KonataAPI.spec --clean
```

### æ–¹å¼äºŒï¼šä½¿ç”¨æ‰“åŒ…è„šæœ¬

1. ç¼–è¾‘ `build.bat`ï¼Œå¡«å†™ä½ çš„ Conda è·¯å¾„å’Œç¯å¢ƒï¼š
   ```bat
   set CONDA_PATH=
   set CONDA_ENV=
   ```

2. åŒå‡»è¿è¡Œ `build.bat`

3. æ‰“åŒ…å®Œæˆåï¼Œå¯æ‰§è¡Œæ–‡ä»¶ä½äº `dist/KonataAPI.exe`

## é¡¹ç›®ç»“æ„

```
KonataAPI/
â”œâ”€â”€ main.py                     # å…¥å£æ–‡ä»¶
â”œâ”€â”€ build.bat                   # æ‰“åŒ…è„šæœ¬
â”œâ”€â”€ KonataAPI.spec              # PyInstaller æ‰“åŒ…é…ç½®
â”œâ”€â”€ src/
â”‚   â””â”€â”€ konata_api/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ app.py              # GUI ä¸»åº”ç”¨ï¼ˆæ ‡ç­¾é¡µå¸ƒå±€ï¼‰
â”‚       â”œâ”€â”€ dialogs.py          # å¯¹è¯æ¡†ç»„ä»¶
â”‚       â”œâ”€â”€ tray.py             # ç³»ç»Ÿæ‰˜ç›˜æ¨¡å—
â”‚       â”œâ”€â”€ utils.py            # å·¥å…·å‡½æ•°
â”‚       â”œâ”€â”€ api.py              # API æŸ¥è¯¢é€»è¾‘
â”‚       â”œâ”€â”€ api_presets.py      # API æ¥å£é¢„è®¾é…ç½®
â”‚       â”œâ”€â”€ stats.py            # ç«™ç‚¹ç»Ÿè®¡æ•°æ®ç®¡ç†
â”‚       â”œâ”€â”€ stats_dialog.py     # ç«™ç‚¹ç»Ÿè®¡æ¨¡å—ï¼ˆStatsFrameï¼‰
â”‚       â”œâ”€â”€ conversation_test.py # Claude çœŸä¼ªæ£€æµ‹æ ¸å¿ƒ
â”‚       â”œâ”€â”€ test_dialog.py      # ç«™ç‚¹æµ‹è¯•æ¨¡å—ï¼ˆTestFrameï¼‰
â”‚       â””â”€â”€ test_settings_dialog.py # æµ‹è¯•è®¾ç½®å¯¹è¯æ¡†
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ icon.ico                # ç¨‹åºå›¾æ ‡
â”‚   â””â”€â”€ background.jpg          # èƒŒæ™¯å›¾ç‰‡
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.example.json     # é…ç½®æ–‡ä»¶ç¤ºä¾‹
â”‚   â”œâ”€â”€ cli_tools.json          # Claude CLI å·¥å…·å®šä¹‰ï¼ˆæ¨¡å‹æ£€æµ‹ç”¨ï¼‰
â”‚   â”œâ”€â”€ cli_system.json         # Claude CLI System Promptï¼ˆæ¨¡å‹æ£€æµ‹ç”¨ï¼‰
â”‚   â””â”€â”€ stats.json              # ç«™ç‚¹æ•°æ®ï¼ˆä¸»æ•°æ®æºï¼Œè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â””â”€â”€ .gitignore
```

## æ„Ÿè°¢Lç«™æ­¤æ–¹ä½¬(@user2996)é’ˆå¯¹claudeæ¨¡å‹çœŸå‡æ–¹æ³•çš„åˆ†äº«ï¼Œæœ¬é¡¹ç›®æ ¹æ® https://apikey.cifang.xyz/ è¿›è¡Œæ¨¡ä»¿ä¸ä¸ªäººé’ˆå¯¹æ€§æ›´æ”¹ã€‚


## License

MIT
